# Screenshot CLI - Development Context

## Project Overview

This is a TypeScript CLI tool for taking full-page screenshots of multiple URLs using Puppeteer. The project has been converted from JavaScript to TypeScript with strict type checking and follows modern Node.js development practices.

## Architecture

### Core Components

- **src/index.ts**: Main CLI application with TypeScript interfaces and strict typing
- **bin/cli.js**: Executable entry point that loads the compiled JavaScript from dist/
- **dist/**: Compiled JavaScript output directory (generated by TypeScript compiler)

### Key Features

- Full-page screenshot capture with automatic scrolling
- Multiple viewport sizes support with WIDTHxHEIGHT format (e.g., 1000x1000)
- Concurrent processing with configurable batch sizes
- Smart filename generation with size/URL indexing, timestamps and URL-based names
- Comprehensive error handling and logging
- Type-safe configuration options with strict size parsing

## Development Standards

### TypeScript Configuration

- Strict mode enabled with all strict flags
- No `any` or `as` type assertions allowed
- Functions defined with `const` declarations
- Classes avoided unless complex state management is required
- Comprehensive type definitions for all interfaces

### Code Style

- Functional programming approach
- Clear, descriptive variable and function names
- Proper error handling with typed error objects
- Minimal dependencies (only Puppeteer and Commander.js)

### Build Process

- TypeScript compilation to CommonJS in dist/ directory
- Source maps and declaration files generated
- Clean build process with npm scripts
- Proper entry points configured for both development and production

## Commands for Development

```bash
# Install dependencies (including TypeScript dev dependencies)
npm install

# Build the project
npm run build

# Development with watch mode
npm run dev

# Type checking only
npm run typecheck

# Clean build artifacts
npm run clean

# Lint code (when ESLint is configured)
npm run lint
```

## Testing the CLI

After building, you can test the CLI locally:

```bash
# Build first
npm run build

# Test the CLI with single size
node bin/cli.js https://example.com

# Test with multiple sizes
node bin/cli.js -s 800x600 -s 1200x900 -s 1920x1080 https://example.com https://google.com
```

## NPM Publishing

The package is configured for npm publishing with:
- Proper entry points in package.json
- Files array specifying what to include in the package
- Executable bin script for global installation
- Semantic versioning

To publish:
```bash
npm run prepublishOnly  # Automatically runs clean and build
npm publish
```

## Dependencies

### Runtime Dependencies
- `puppeteer`: Browser automation for screenshots
- `commander`: CLI argument parsing

### Development Dependencies
- `typescript`: TypeScript compiler
- `@types/node`: Node.js type definitions
- `eslint` + TypeScript ESLint plugins: Code linting

## File Structure

```
├── src/
│   └── index.ts          # Main TypeScript source
├── bin/
│   └── cli.js            # Executable entry point
├── dist/                 # Compiled output (gitignored)
├── node_modules/         # Dependencies (gitignored)
├── screenshots/          # Default output directory (gitignored)
├── package.json          # Package configuration
├── tsconfig.json         # TypeScript configuration
├── .gitignore           # Git ignore rules
├── README.md            # User documentation
└── CLAUDE.md            # This development context file
```

## CLI Usage Examples

```bash
# Single size (default 1440x1080)
node bin/cli.js https://example.com

# Custom single size
node bin/cli.js -s 1000x1000 https://example.com

# Multiple sizes with multiple URLs
node bin/cli.js -s 400x300 -s 800x600 -s 1200x900 https://example.com https://httpbin.org/html

# Output goes to custom directory with proper indexing:
# 01_01_timestamp_400x300_example_com.png (Size 1, URL 1)
# 01_02_timestamp_400x300_httpbin_orghtml.png (Size 1, URL 2)
# 02_01_timestamp_800x600_example_com.png (Size 2, URL 1)
# 02_02_timestamp_800x600_httpbin_orghtml.png (Size 2, URL 2)
# 03_01_timestamp_1200x900_example_com.png (Size 3, URL 1)
# 03_02_timestamp_1200x900_httpbin_orghtml.png (Size 3, URL 2)
```

## Technical Implementation Details

### Size Specification
- Size format: `WIDTHxHEIGHT` (e.g., 1000x1000, 800x600)
- Multiple sizes supported via repeated `-s` option
- Regex validation: `/^(\d+)x(\d+)$/`
- Default size: 1440x1080

### Screenshot Task Processing
- Creates `ScreenshotTask` objects for each size/URL combination
- Processing order: All URLs for Size 1, then all URLs for Size 2, etc.
- Filename format: `{sizeIndex}_{urlIndex}_{timestamp}_{size}_{hostname}{pathname}.png`
- Zero-padded indices (2 digits each)

### Type Safety
- `Size` interface with `width` and `height` numbers
- `ScreenshotTask` interface combining URL, size, and index information
- Strict type checking for size parsing with proper error handling

## Notes for Future Development

- All type definitions are strict - no implicit any types
- Error handling uses proper Error type checking
- Async/await patterns used throughout
- No classes used - functional approach maintained
- Puppeteer browser instances are properly cleaned up
- Concurrent processing is implemented with proper batch handling
- Size parsing includes comprehensive validation and error messages